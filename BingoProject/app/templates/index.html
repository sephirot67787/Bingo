
<!DOCTYPE html>
<html>
<head>
<title>Bingo Multiplayer</title>
<style>
body{background:#111;color:white;font-family:Arial;text-align:center}
table{margin:auto;border-collapse:collapse}
td{width:60px;height:60px;border:1px solid white}
.hit{background:green}
.num{font-size:100px;color:gold}
</style>
</head>
<body>

<h1>BINGO</h1>
<div>
Nickname:
<input id="nick">
<button onclick="connect()">Entra</button>
</div>

<div class="num" id="num">-</div>
<button onclick="ready()">SONO PRONTO</button>
<button onclick="bingo()">BINGO!</button>

<h3 id="status"></h3>

<table id="cartella"></table>

<script>
let ws;
let nick;
let cartella=[];
let estratti=[];

function connect(){
 nick=document.getElementById("nick").value;
 ws=new WebSocket("ws://localhost:8000/ws/room1");

 ws.onopen=()=>{ ws.send(nick); };
 ws.onmessage=(e)=>handle(e.data);
 crea();
}

function handle(msg){
 if(msg==="NICK_TAKEN"){ alert("Nickname gi√† usato"); return; }

 if(msg.startsWith("NUM:")){
  let n=parseInt(msg.split(":")[1]);
  document.getElementById("num").innerText=n;
  estratti.push(n);
  draw();
 }

 if(msg.startsWith("WIN:")){
  document.getElementById("status").innerText="üèÜ BINGO VINTO DA "+msg.split(":")[1];
 }
}

function ready(){ ws.send("READY"); }
function bingo(){ ws.send("BINGO"); }

function crea(){
 let r=[[1,15],[16,30],[31,45],[46,60],[61,75]];
 for(let c=0;c<5;c++){
  let a=[];
  for(let i=r[c][0];i<=r[c][1];i++)a.push(i);
  a.sort(()=>Math.random()-0.5);
  cartella[c]=a.slice(0,5);
 }
 cartella[2][2]="FREE";
 draw();
}

function draw(){
 let t=document.getElementById("cartella");
 t.innerHTML="";
 for(let r=0;r<5;r++){
  let tr=document.createElement("tr");
  for(let c=0;c<5;c++){
   let td=document.createElement("td");
   let v=cartella[c][r];
   td.innerText=v;
   if(v==="FREE"||estratti.includes(v))td.classList.add("hit");
   tr.appendChild(td);
  }
  t.appendChild(tr);
 }
}
</script>
</body>
</html>
